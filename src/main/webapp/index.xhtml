<ui:composition template="commun/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="mainContent">

        <!-- Barre de recherche -->
        <section class="app-search">
            <ui:include src="search/search.xhtml"/>
        </section>

        <!-- Contenu principal avec 3 panneaux -->
        <h:panelGroup id="centerContent" class="app-content">

            <!-- Tree -->
            <h:panelGroup id="leftTreePanel" class="left-tree" rendered="#{applicationBean.showTreePanel}">
                <ui:fragment>
                    <ui:include src="tree/tree.xhtml"/>
                </ui:fragment>
            </h:panelGroup>

            <h:panelGroup styleClass="center-content">
                <!-- Conteneur des cartes -->
                <h:panelGroup id="cardsContainer" rendered="#{applicationBean.showCards}">
                    <!-- Zone de présentation du site -->
                    <div class="site-presentation-container">
                        <div class="site-presentation-content">
                            <div class="site-presentation-header">
                                <div class="site-presentation-icon">
                                    <i class="pi pi-info-circle" />
                                </div>
                                <h2 class="site-presentation-title">À propos d'Opentypo</h2>
                            </div>
                            <div class="site-presentation-body">
                                <p class="site-presentation-text">
                                    Opentypo est une plateforme de recherche et de gestion de typologies archéologiques développée par le CNRS. 
                                    Cette application permet aux chercheurs de consulter, gérer et enrichir une base de données complète de types 
                                    archéologiques, facilitant ainsi la recherche scientifique et la documentation du patrimoine archéologique.
                                </p>
                                <div class="site-presentation-features">
                                    <div class="site-presentation-feature">
                                        <i class="pi pi-search site-presentation-feature-icon" />
                                        <div class="site-presentation-feature-content">
                                            <h4 class="site-presentation-feature-title">Recherche avancée</h4>
                                            <p class="site-presentation-feature-text">Explorez notre base de données avec des outils de recherche puissants et précis</p>
                                        </div>
                                    </div>
                                    <div class="site-presentation-feature">
                                        <i class="pi pi-database site-presentation-feature-icon" />
                                        <div class="site-presentation-feature-content">
                                            <h4 class="site-presentation-feature-title">Base de données complète</h4>
                                            <p class="site-presentation-feature-text">Accédez à une collection exhaustive de typologies archéologiques documentées</p>
                                        </div>
                                    </div>
                                    <div class="site-presentation-feature">
                                        <i class="pi pi-users site-presentation-feature-icon" />
                                        <div class="site-presentation-feature-content">
                                            <h4 class="site-presentation-feature-title">Collaboration</h4>
                                            <p class="site-presentation-feature-text">Participez à l'enrichissement de la base de données en proposant de nouveaux types</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section d'action pour créer un référentiel -->
                    <div style="padding-top: 1rem; padding-right: 1.5rem; text-align: right">
                        <p:commandButton value="Créer un nouveau référentiel"
                                         icon="pi pi-arrow-right"
                                         styleClass="referentiel-btn referentiel-btn-validate"
                                         onclick="PF('addReferentielDialog').show(); return false;"
                                         process="@this"
                                         update="@none"/>
                    </div>

                    <div class="modern-cards-container">
                        <h:form>
                            <div class="modern-cards-grid">
                                <ui:repeat value="#{applicationBean.referentiels}" var="referentiel">
                                    <p:commandLink action="#{applicationBean.showReferentiel()}"
                                                 styleClass="modern-card"
                                                 process="@this"
                                                 update=":centerContent">
                                        <div class="modern-card-content">
                                            <div class="modern-card-header">
                                                <div class="modern-card-icon">
                                                    <i class="pi pi-database" />
                                                </div>
                                                <h3 class="modern-card-title">#{referentiel.nom}</h3>
                                            </div>
                                            <p class="modern-card-description">
                                                #{empty referentiel.commentaire ? 'Aucune description disponible' : referentiel.commentaire}
                                            </p>
                                        </div>
                                    </p:commandLink>
                                </ui:repeat>
                                
                                <!-- Message si aucun référentiel n'est disponible -->
                                <h:panelGroup rendered="#{empty applicationBean.referentiels}" styleClass="no-referentiels-message">
                                    <div class="modern-card">
                                        <div class="modern-card-content">
                                            <div class="modern-card-header">
                                                <div class="modern-card-icon">
                                                    <i class="pi pi-info-circle" />
                                                </div>
                                                <h3 class="modern-card-title">Aucun référentiel disponible</h3>
                                            </div>
                                            <p class="modern-card-description">
                                                Il n'y a actuellement aucun référentiel dans la base de données. 
                                                Utilisez le bouton "Créer un nouveau référentiel" pour en ajouter un.
                                            </p>
                                        </div>
                                    </div>
                                </h:panelGroup>
                            </div>
                        </h:form>
                    </div>
                    
                    <!-- Inclusion du dialogue de création de référentiel -->
                    <ui:include src="tree/referentielDialog.xhtml"/>
                </h:panelGroup>

                <h:panelGroup id="contentPanels" rendered="#{applicationBean.isShowDetail()}" layout="block" class="info-concept">
                    <ui:include src="details/breadCrumb.xhtml"/>

                    <!-- Panneau référentiel -->
                    <h:panelGroup rendered="#{applicationBean.showReferentielPanel}">
                        <ui:include src="details/referentiel.xhtml"/>
                    </h:panelGroup>

                    <!-- Panneau catégorie -->
                    <h:panelGroup rendered="#{applicationBean.showCategoryPanel}">
                        <ui:include src="details/category.xhtml"/>
                    </h:panelGroup>

                    <!-- Panneau groupe -->
                    <h:panelGroup rendered="#{applicationBean.showGroupePanel}">
                        <ui:include src="details/groupe.xhtml"/>
                    </h:panelGroup>

                    <!-- Panneau série -->
                    <h:panelGroup rendered="#{applicationBean.showSeriePanel}">
                        <ui:include src="details/serie.xhtml"/>
                    </h:panelGroup>

                    <!-- Panneau série -->
                    <h:panelGroup rendered="#{applicationBean.showTypePanel}">
                        <ui:include src="details/type.xhtml"/>
                    </h:panelGroup>
                </h:panelGroup>
            </h:panelGroup>

            <!-- Panneau droit masqué -->
            <h:panelGroup rendered="true" >
                <div id="panelRight" class="search-result" style="display: none;">
                    <ui:include src="search/searchResult.xhtml"/>
                </div>
            </h:panelGroup>
        </h:panelGroup>
    </ui:define>
</ui:composition>
