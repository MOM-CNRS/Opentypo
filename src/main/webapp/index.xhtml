<ui:composition template="commun/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="mainContent">

        <!-- Barre de recherche -->
        <section class="app-search">
            <ui:include src="search/search.xhtml"/>
        </section>

        <!-- Contenu principal avec 3 panneaux -->
        <h:panelGroup id="centerContent" class="app-content">

            <!-- Tree -->
            <h:panelGroup id="leftTreePanel" class="left-tree" rendered="#{applicationBean.showTreePanel}">
                <ui:fragment>
                    <ui:include src="tree/tree.xhtml"/>
                </ui:fragment>
            </h:panelGroup>

            <h:panelGroup id="rightTreePanel" styleClass="center-content">
                <!-- Conteneur des cartes -->
                <h:panelGroup id="cardsContainer" rendered="#{applicationBean.showCollectionsPanel}">
                    <!-- Zone de présentation du site -->
                    <div class="site-presentation-container">
                        <div class="site-presentation-content">
                            <div class="site-presentation-header">
                                <div class="site-presentation-icon">
                                    <i class="pi pi-info-circle" />
                                </div>
                                <h2 class="site-presentation-title">À propos d'Opentypo</h2>
                            </div>
                            <div class="site-presentation-body">
                                <p class="site-presentation-text">
                                    Opentypo est une plateforme de recherche et de gestion de typologies archéologiques développée par le CNRS. 
                                    Cette application permet aux chercheurs de consulter, gérer et enrichir une base de données complète de types 
                                    archéologiques, facilitant ainsi la recherche scientifique et la documentation du patrimoine archéologique.
                                </p>
                                <div class="site-presentation-features">
                                    <div class="site-presentation-feature">
                                        <i class="pi pi-search site-presentation-feature-icon" />
                                        <div class="site-presentation-feature-content">
                                            <h4 class="site-presentation-feature-title">Recherche avancée</h4>
                                            <p class="site-presentation-feature-text">Explorez notre base de données avec des outils de recherche puissants et précis</p>
                                        </div>
                                    </div>
                                    <div class="site-presentation-feature">
                                        <i class="pi pi-database site-presentation-feature-icon" />
                                        <div class="site-presentation-feature-content">
                                            <h4 class="site-presentation-feature-title">Base de données complète</h4>
                                            <p class="site-presentation-feature-text">Accédez à une collection exhaustive de typologies archéologiques documentées</p>
                                        </div>
                                    </div>
                                    <div class="site-presentation-feature">
                                        <i class="pi pi-users site-presentation-feature-icon" />
                                        <div class="site-presentation-feature-content">
                                            <h4 class="site-presentation-feature-title">Collaboration</h4>
                                            <p class="site-presentation-feature-text">Participez à l'enrichissement de la base de données en proposant de nouveaux types</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section d'action pour créer une collection -->
                    <h:panelGroup id="create-collection-section" class="create-collection-section"
                         style="width: 100%; text-align: right; padding-top: 20px; padding-right: 20px"
                         rendered="#{loginBean.canCreateOrEdit()}">
                        <p:commandButton value="Créer une nouvelle collection"
                                         icon="pi pi-plus"
                                         styleClass="collection-btn collection-btn-validate"
                                         onclick="PF('addCollectionDialog').show(); return false;"
                                         process="@this"
                                         update="@none"/>
                    </h:panelGroup>

                    <div class="modern-cards-container">
                        <h:form>
                            <div class="modern-cards-grid">
                                <ui:repeat value="#{applicationBean.collections}" var="collection">
                                    <p:commandLink action="#{applicationBean.showCollectionDetail(collection)}"
                                                 styleClass="modern-card"
                                                 process="@this" ajax="true"
                                                 update=":centerContent :selectedEntityLabel :searchForm :breadcrumbContent :treeContainer"
                                                 onstart="showLoading('Chargement de la collection...', 'spinner');"
                                                 oncomplete="setTimeout(function(){hideLoading(); ensureRootTogglerVisible();}, 500);"
                                                 onerror="forceHideLoading();">
                                        <div class="modern-card-content">
                                            <div class="modern-card-header">
                                                <div class="modern-card-icon">
                                                    <i class="pi pi-folder" />
                                                </div>
                                                <h3 class="modern-card-title">#{collection.nom}</h3>
                                            </div>
                                            <p class="modern-card-description">
                                                #{empty collection.commentaire ? 'Aucune description disponible' : collection.commentaire}
                                            </p>
                                        </div>
                                    </p:commandLink>
                                </ui:repeat>
                                
                                <!-- Message si aucune collection n'est disponible -->
                                <h:panelGroup rendered="#{empty applicationBean.collections}" styleClass="no-collections-message">
                                    <div class="modern-card">
                                        <div class="modern-card-content">
                                            <div class="modern-card-header">
                                                <div class="modern-card-icon">
                                                    <i class="pi pi-info-circle" />
                                                </div>
                                                <h3 class="modern-card-title">Aucune collection disponible</h3>
                                            </div>
                                            <p class="modern-card-description">
                                                Il n'y a actuellement aucune collection dans la base de données. 
                                                Utilisez le bouton "Créer une nouvelle collection" pour en ajouter une.
                                            </p>
                                        </div>
                                    </div>
                                </h:panelGroup>
                            </div>
                        </h:form>
                    </div>
                    
                    <!-- Inclusion du dialogue de création de collection -->
                    <ui:include src="dialogs/collectionDialog.xhtml"/>
                </h:panelGroup>

                <h:panelGroup id="contentPanels" rendered="#{applicationBean.isShowDetail()}" layout="block" class="info-concept">

                    <h:panelGroup rendered="#{applicationBean.showBreadCrumbPanel}">
                        <ui:include src="details/breadCrumb.xhtml"/>
                    </h:panelGroup>

                    <!-- Panneau référentiel -->
                    <h:panelGroup rendered="#{applicationBean.showReferencesPanel}">
                        <ui:include src="details/collection.xhtml"/>
                    </h:panelGroup>

                    <!-- Panneau référentiel -->
                    <h:panelGroup rendered="#{applicationBean.showReferencePanel}">
                        <ui:include src="details/reference.xhtml"/>
                    </h:panelGroup>

                    <!-- Panneau catégorie -->
                    <h:panelGroup rendered="#{applicationBean.showCategoryPanel}">
                        <ui:include src="details/category.xhtml"/>
                    </h:panelGroup>

                    <!-- Panneau groupe -->
                    <h:panelGroup rendered="#{applicationBean.isShowGroupePanel()}">
                        <ui:include src="details/groupe.xhtml"/>
                    </h:panelGroup>

                    <!-- Panneau série -->
                    <h:panelGroup rendered="#{applicationBean.showSeriePanel}">
                        <ui:include src="details/serie.xhtml"/>
                    </h:panelGroup>

                    <!-- Panneau série -->
                    <h:panelGroup rendered="#{applicationBean.showTypePanel}">
                        <ui:include src="details/type.xhtml"/>
                    </h:panelGroup>
                </h:panelGroup>
            </h:panelGroup>

            <!-- Panneau droit masqué -->
            <h:panelGroup rendered="true" >
                <div id="panelRight" class="search-result hidden">
                    <ui:include src="search/searchResult.xhtml"/>
                </div>
            </h:panelGroup>
        </h:panelGroup>
    </ui:define>

    <style>
        /* Section de création de collection - Design moderne et responsive */
        .create-collection-section {
            width: 100%;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            box-sizing: border-box;
        }

        /* Bouton de création de collection - Style moderne avec gradient */
        .create-collection-btn {
            padding: 0.625rem 1.25rem !important;
            font-size: 0.9375rem !important;
            font-weight: 600 !important;
            border-radius: 8px !important;
            background: linear-gradient(135deg, var(--color-action-main, #47624D) 0%, rgba(71, 98, 77, 0.9) 100%) !important;
            border: none !important;
            color: #ffffff !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            display: inline-flex !important;
            align-items: center !important;
            gap: 0.625rem !important;
            box-shadow: 0 2px 8px rgba(71, 98, 77, 0.25) !important;
            cursor: pointer !important;
        }

        .create-collection-btn:hover {
            background: linear-gradient(135deg, #3a4f3e 0%, var(--color-action-main, #47624D) 100%) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 12px rgba(71, 98, 77, 0.35) !important;
        }

        .create-collection-btn:active {
            transform: translateY(0) !important;
            box-shadow: 0 2px 6px rgba(71, 98, 77, 0.3) !important;
        }

        .create-collection-btn .ui-button-icon-left,
        .create-collection-btn .ui-button-icon {
            font-size: 1rem !important;
        }

        .create-collection-btn .ui-button-text {
            padding: 0 !important;
        }

        /* Responsive pour la section de création */
        @media (max-width: 768px) {
            .create-collection-section {
                justify-content: center;
                padding: 1rem 0.75rem;
            }

            .create-collection-btn {
                width: 100%;
                max-width: 400px;
                justify-content: center;
                font-size: 0.875rem !important;
                padding: 0.75rem 1rem !important;
            }
        }

        @media (max-width: 480px) {
            .create-collection-section {
                padding: 0.75rem 0.5rem;
            }

            .create-collection-btn {
                font-size: 0.8125rem !important;
                padding: 0.625rem 0.875rem !important;
            }
        }
    </style>
</ui:composition>
