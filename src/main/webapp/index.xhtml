<ui:composition template="commun/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="mainContent">

        <!-- Barre de recherche -->
        <section class="app-search">
            <ui:include src="search/search.xhtml"/>
        </section>

        <!-- Contenu principal avec 3 panneaux -->
        <section class="app-content">

            <!-- Conteneur central -->
            <h:panelGroup rendered="#{treeBean.root != null}">
                <!-- Tree -->
                <div class="left-tree" id="leftTreePanel">
                    <!-- Menu d’onglets -->
                    <h:form>
                        <p:menuitem icon="pi pi-sitemap"
                                    title="Concept"
                                    outcome="/theso_tree/tree.xhtml?faces-redirect=true"/>
                    </h:form>

                    <!-- Affichage dynamique de l’arbre -->
                    <ui:fragment>
                        <ui:include src="tree/treeActions.xhtml"/>
                        <ui:include src="tree/tree.xhtml"/>
                    </ui:fragment>
                </div>
            </h:panelGroup>

            <h:panelGroup id="centerContent" styleClass="center-content">
                <!-- Styles pour la zone de présentation - garantis pour persister -->
                <style>
                    .site-presentation-container {
                        width: 100%;
                        padding: 0 1.5rem;
                        box-sizing: border-box;
                    }

                    .site-presentation-content {
                        background: #ffffff;
                        border: 1px solid rgba(71, 98, 77, 0.2);
                        border-left: 4px solid var(--color-action-main, #47624D);
                        border-radius: 8px;
                        padding: 1.25rem 1.5rem;
                        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
                    }

                    .site-presentation-header {
                        display: flex;
                        align-items: center;
                        gap: 0.875rem;
                        margin-bottom: 1rem;
                        padding-bottom: 0.875rem;
                        border-bottom: 1px solid rgba(71, 98, 77, 0.15);
                    }

                    .site-presentation-icon {
                        width: 40px;
                        height: 40px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        background: var(--color-action-main, #47624D);
                        border-radius: 8px;
                        color: #ffffff;
                        font-size: 1.25rem;
                        flex-shrink: 0;
                    }

                    .site-presentation-title {
                        font-size: 1.375rem;
                        font-weight: 700;
                        color: var(--color-action-main, #47624D);
                        margin: 0;
                    }

                    .site-presentation-body {
                        display: flex;
                        flex-direction: column;
                        gap: 1rem;
                    }

                    .site-presentation-text {
                        font-size: 0.9375rem;
                        line-height: 1.6;
                        color: var(--color-text-primary, #333);
                        margin: 0;
                        text-align: justify;
                    }

                    .site-presentation-features {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
                        gap: 0.875rem;
                        margin-top: 0.5rem;
                    }

                    .site-presentation-feature {
                        display: flex;
                        align-items: flex-start;
                        gap: 0.75rem;
                        padding: 0.875rem;
                        background: #ffffff;
                        border: 1px solid rgba(71, 98, 77, 0.15);
                        border-left: 3px solid var(--color-action-main, #47624D);
                        border-radius: 6px;
                    }

                    .site-presentation-feature-icon {
                        width: 32px;
                        height: 32px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        background: rgba(71, 98, 77, 0.1);
                        border-radius: 6px;
                        color: var(--color-action-main, #47624D);
                        font-size: 1rem;
                        flex-shrink: 0;
                    }

                    .site-presentation-feature-content {
                        flex: 1;
                        display: flex;
                        flex-direction: column;
                        gap: 0.375rem;
                    }

                    .site-presentation-feature-title {
                        font-size: 0.9375rem;
                        font-weight: 600;
                        color: var(--color-text-primary, #333);
                        margin: 0;
                    }

                    .site-presentation-feature-text {
                        font-size: 0.8125rem;
                        line-height: 1.5;
                        color: var(--color-text-secondary, #666);
                        margin: 0;
                    }

                    @media (max-width: 768px) {
                        .site-presentation-container {
                            padding: 0 1rem;
                        }

                        .site-presentation-content {
                            padding: 1rem;
                            border-left-width: 3px;
                        }

                        .site-presentation-header {
                            gap: 0.75rem;
                            margin-bottom: 0.875rem;
                            padding-bottom: 0.75rem;
                        }

                        .site-presentation-icon {
                            width: 36px;
                            height: 36px;
                            font-size: 1.125rem;
                        }

                        .site-presentation-title {
                            font-size: 1.25rem;
                        }

                        .site-presentation-body {
                            gap: 0.875rem;
                        }

                        .site-presentation-text {
                            font-size: 0.875rem;
                            text-align: left;
                        }

                        .site-presentation-features {
                            grid-template-columns: 1fr;
                            gap: 0.75rem;
                        }

                        .site-presentation-feature {
                            padding: 0.75rem;
                        }

                        .site-presentation-feature-icon {
                            width: 30px;
                            height: 30px;
                            font-size: 0.9375rem;
                        }
                    }

                    @media (max-width: 480px) {
                        .site-presentation-container {
                            padding: 0 0.75rem;
                        }

                        .site-presentation-content {
                            padding: 0.875rem;
                        }

                        .site-presentation-icon {
                            width: 32px;
                            height: 32px;
                            font-size: 1rem;
                        }

                        .site-presentation-title {
                            font-size: 1.125rem;
                        }

                        .site-presentation-text {
                            font-size: 0.8125rem;
                        }

                        .site-presentation-feature {
                            padding: 0.625rem;
                        }

                        .site-presentation-feature-icon {
                            width: 28px;
                            height: 28px;
                            font-size: 0.875rem;
                        }

                        .site-presentation-feature-title {
                            font-size: 0.875rem;
                        }

                        .site-presentation-feature-text {
                            font-size: 0.75rem;
                        }
                    }
                </style>

                <!-- Conteneur des cartes -->
                <h:panelGroup id="cardsContainer" rendered="#{applicationBean.showCards}">
                    <!-- Zone de présentation du site -->
                    <div class="site-presentation-container">
                        <div class="site-presentation-content">
                            <div class="site-presentation-header">
                                <div class="site-presentation-icon">
                                    <i class="pi pi-info-circle" />
                                </div>
                                <h2 class="site-presentation-title">À propos d'Opentypo</h2>
                            </div>
                            <div class="site-presentation-body">
                                <p class="site-presentation-text">
                                    Opentypo est une plateforme de recherche et de gestion de typologies archéologiques développée par le CNRS. 
                                    Cette application permet aux chercheurs de consulter, gérer et enrichir une base de données complète de types 
                                    archéologiques, facilitant ainsi la recherche scientifique et la documentation du patrimoine archéologique.
                                </p>
                                <div class="site-presentation-features">
                                    <div class="site-presentation-feature">
                                        <i class="pi pi-search site-presentation-feature-icon"></i>
                                        <div class="site-presentation-feature-content">
                                            <h4 class="site-presentation-feature-title">Recherche avancée</h4>
                                            <p class="site-presentation-feature-text">Explorez notre base de données avec des outils de recherche puissants et précis</p>
                                        </div>
                                    </div>
                                    <div class="site-presentation-feature">
                                        <i class="pi pi-database site-presentation-feature-icon"></i>
                                        <div class="site-presentation-feature-content">
                                            <h4 class="site-presentation-feature-title">Base de données complète</h4>
                                            <p class="site-presentation-feature-text">Accédez à une collection exhaustive de typologies archéologiques documentées</p>
                                        </div>
                                    </div>
                                    <div class="site-presentation-feature">
                                        <i class="pi pi-users site-presentation-feature-icon"></i>
                                        <div class="site-presentation-feature-content">
                                            <h4 class="site-presentation-feature-title">Collaboration</h4>
                                            <p class="site-presentation-feature-text">Participez à l'enrichissement de la base de données en proposant de nouveaux types</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modern-cards-container">
                        <h:form>
                            <div class="modern-cards-grid">
                                <p:commandLink action="#{applicationBean.showReferentiel()}" 
                                             styleClass="modern-card"
                                             process="@this" 
                                             update=":centerContent">
                                    <div class="modern-card-content">
                                        <div class="modern-card-header">
                                            <div class="modern-card-icon">
                                                <i class="pi pi-database" />
                                            </div>
                                            <h3 class="modern-card-title">CERAMIQUE</h3>
                                        </div>
                                        <p class="modern-card-description">Description courte du contenu ou contexte. Description courte du contenu ou contexte. Description courte du contenu ou contexte.Description courte du contenu ou contexte Description courte du contenu ou contexte.Description courte du contenu ou contexteDescription courte du contenu ou contexteDescription courte du contenu ou contexteDescription courte du contenu ou contexte</p>
                                    </div>
                                </p:commandLink>

                                <p:commandLink action="#{applicationBean.showReferentiel()}"
                                             styleClass="modern-card"
                                             process="@this"
                                             update=":centerContent">
                                    <div class="modern-card-content">
                                        <div class="modern-card-header">
                                            <div class="modern-card-icon">
                                                <i class="pi pi-database" />
                                            </div>
                                            <h3 class="modern-card-title">INSTRUMENTUM</h3>
                                        </div>
                                        <p class="modern-card-description">Description courte du contenu ou contexte</p>
                                    </div>
                                </p:commandLink>

                                <p:commandLink action="#{applicationBean.showReferentiel()}"
                                               styleClass="modern-card"
                                               process="@this"
                                               update=":centerContent">
                                    <div class="modern-card-content">
                                        <div class="modern-card-header">
                                            <div class="modern-card-icon">
                                                <i class="pi pi-database" />
                                            </div>
                                            <h3 class="modern-card-title">MONNAIE</h3>
                                        </div>
                                        <p class="modern-card-description">Description courte du contenu ou contexte</p>
                                    </div>
                                </p:commandLink>
                            </div>
                        </h:form>
                    </div>
                </h:panelGroup>

                <!-- Panneau référentiel -->
                <h:panelGroup rendered="#{applicationBean.showReferentielPanel}">
                    <div class="info-concept">
                        <ui:include src="details/referentiel.xhtml"/>
                    </div>
                </h:panelGroup>

                 <!-- Panneau catégorie -->
                 <h:panelGroup rendered="#{applicationBean.showCategoryPanel}">
                    <div class="info-concept">
                        <ui:include src="details/category.xhtml"/>
                    </div>
                </h:panelGroup>

                <!-- Panneau groupe -->
                <h:panelGroup rendered="#{applicationBean.showGroupePanel}">
                    <div class="info-concept">
                        <ui:include src="details/groupe.xhtml"/>
                    </div>
                </h:panelGroup>

                <!-- Panneau série -->
                <h:panelGroup rendered="#{applicationBean.showSeriePanel}">
                    <div class="info-concept">
                        <ui:include src="details/serie.xhtml"/>
                    </div>
                </h:panelGroup>

                <!-- Panneau série -->
                <h:panelGroup rendered="#{applicationBean.showTypePanel}">
                    <div class="info-concept">
                        <ui:include src="details/type.xhtml"/>
                    </div>
                </h:panelGroup>
            </h:panelGroup>

            <!-- Panneau droit masqué -->
            <h:panelGroup rendered="true" >
                <div id="panelRight" class="search-result" style="display: none;">
                    <ui:include src="search/searchResult.xhtml"/>
                </div>
            </h:panelGroup>
        </section>

        <!-- JS toggle résultat -->
        <h:outputScript target="body">
            function toggleRightPanel() {
                const panel = document.getElementById('panelRight');
                panel.style.display = (panel.style.display === 'none') ? 'block' : 'none';
            }
            
            // S'assurer que les styles sont appliqués après chaque mise à jour AJAX
            if (window.PrimeFaces) {
                PrimeFaces.ajax.addOnUpdate(function(data) {
                    // Vérifier si le conteneur de présentation existe et réappliquer les styles si nécessaire
                    var presentationContainer = document.querySelector('.site-presentation-container');
                    if (presentationContainer) {
                        // Les styles inline garantissent la persistance
                        // Cette fonction peut être étendue pour d'autres vérifications
                    }
                });
            }
        </h:outputScript>
    </ui:define>
</ui:composition>
