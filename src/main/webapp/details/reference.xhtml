<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions">

    <!-- Contenu dynamique -->
    <h:panelGroup class="image-container">
        <!-- Afficher l'image si disponible -->
        <p:graphicImage
                value="#{applicationBean.selectedReference.image.url}"
                styleClass="research-image"
                alt="Image du référentiel"
                rendered="#{not empty applicationBean.selectedReference.image and not empty applicationBean.selectedReference.image.url}"/>

        <!-- Afficher le texte "OpenTypo" si pas d'image -->
        <h:panelGroup class="reference-image-placeholder"
             rendered="#{empty applicationBean.selectedReference.image or empty applicationBean.selectedReference.image.url}">
            <span class="reference-placeholder-text">OpenTypo</span>
        </h:panelGroup>
    </h:panelGroup>

    <h:panelGroup class="row">
        <div class="col-md-12">
            <div class="concept-info-panel">
                <!-- En-tête avec titre et actions -->
                <div class="concept-info-header">
                    <div class="concept-info-title-section">
                        <div class="concept-info-language-flag">
                            <h:graphicImage library="img" name="flag/fr.png"
                                            styleClass="language-flag"
                                            alt="Français"
                                            title="Français"/>
                        </div>
                        <h2 class="concept-info-title">#{applicationBean.selectedReference.nom}</h2>
                    </div>
                    <div class="concept-info-actions">
                        <p:commandLink action="#" process="@this" update="@none" styleClass="concept-action-button">
                            <i class="pi pi-file-edit" />
                            <p:tooltip value="Paramètres" position="top"/>
                        </p:commandLink>
                        <p:commandLink action="#" process="@this" update="@none" styleClass="concept-action-button">
                            <i class="pi pi-trash" />
                            <p:tooltip value="Marquer" position="top"/>
                        </p:commandLink>
                    </div>
                </div>

                <!-- Grille d'informations -->
                <div class="concept-info-grid">
                    <h:panelGroup class="concept-info-item">
                        <div class="concept-info-label">
                            <i class="pi pi-database concept-info-icon" />
                            <span>Code</span>
                        </div>
                        <div class="concept-info-value">#{applicationBean.selectedReference.code}</div>
                    </h:panelGroup>

                    <h:panelGroup class="concept-info-item concept-info-item-full">
                        <div class="concept-info-label">
                            <i class="pi pi-file concept-info-icon" />
                            <span>Description</span>
                        </div>
                        <div class="concept-info-value concept-info-description">
                            #{applicationBean.selectedReference.commentaire}
                        </div>
                    </h:panelGroup>

                    <h:panelGroup class="concept-info-item concept-info-item-full">
                        <div class="concept-info-label">
                            <i class="pi pi-user concept-info-icon" />
                            <span>Auteur(s)</span>
                        </div>
                        <div class="concept-info-value bibliographie-container">
                            <ui:fragment rendered="#{not empty applicationBean.selectedReference.auteurs}">
                                <ui:repeat value="#{applicationBean.selectedReference.auteurs}" var="auteur" varStatus="status">
                                    <span class="bibliographie-badge">
                                        <i class="pi pi-user bibliographie-badge-icon" />
                                        <span class="bibliographie-badge-text">#{auteur.prenom} #{auteur.nom}</span>
                                    </span>
                                </ui:repeat>
                            </ui:fragment>
                            <h:outputText value="Aucun auteur disponible" 
                                         rendered="#{empty applicationBean.selectedReference.auteurs}"
                                         styleClass="bibliographie-empty" />
                        </div>
                    </h:panelGroup>

                    <h:panelGroup class="concept-info-item concept-info-item-full">
                        <div class="concept-info-label">
                            <i class="pi pi-book concept-info-icon" />
                            <span>Référence bibliographique</span>
                        </div>
                        <div class="concept-info-value bibliographie-container">
                            <ui:fragment rendered="#{not empty applicationBean.selectedReference.bibliographie}">
                                <ui:repeat value="#{fn:split(applicationBean.selectedReference.bibliographie, ';')}" var="ref" varStatus="status">
                                    <ui:fragment rendered="#{not empty ref and fn:trim(ref) != ''}">
                                        <span class="bibliographie-badge">
                                            <i class="pi pi-book bibliographie-badge-icon" />
                                            <span class="bibliographie-badge-text">#{fn:trim(ref)}</span>
                                        </span>
                                    </ui:fragment>
                                </ui:repeat>
                            </ui:fragment>
                            <h:outputText value="Aucune référence bibliographique disponible" 
                                         rendered="#{empty applicationBean.selectedReference.bibliographie}"
                                         styleClass="bibliographie-empty" />
                        </div>
                    </h:panelGroup>
                </div>
            </div>

            <div style="margin-top: 20px">
                <!-- Bloc unifié pour les catégories -->
                <div class="categories-unified-block">
                    <!-- Section header pour les catégories -->
                    <div class="collection-references-header">
                        <div class="collection-references-title-section">
                            <div class="collection-references-icon">
                                <i class="pi pi-tag" />
                            </div>
                            <div class="collection-references-title-wrapper">
                                <h3 class="collection-references-title">Catégories du référentiel</h3>
                                <span class="collection-references-subtitle">
                                    #{applicationBean.selectedReference.nom}
                                </span>
                            </div>
                        </div>
                        <h:panelGroup class="collection-references-actions" rendered="#{loginBean.canCreateOrEdit()}">
                            <p:commandButton value="Créer une catégorie"
                                             icon="pi pi-plus"
                                             styleClass="collection-create-btn"
                                             onclick="PF('createCategoryDialog').show(); return false;"
                                             process="@this"
                                             update="@none"/>
                        </h:panelGroup>
                    </div>

                    <!-- Liste des catégories -->
                    <div class="reference-cards-container">
                    <h:form>
                        <div class="reference-cards-grid">
                            <p:commandLink action="#{applicationBean.showCategory()}"
                                           styleClass="reference-card"
                                           process="@this"
                                           update=":centerContent">
                                <div class="reference-card-content">
                                    <div class="reference-card-header">
                                        <div class="reference-card-icon">
                                            <i class="pi pi-tag" />
                                        </div>
                                        <div class="reference-card-title-wrapper">
                                            <h3 class="reference-card-title">Titre CAT</h3>
                                            <span class="reference-card-code">Code CAT</span>
                                        </div>
                                    </div>
                                    <p class="reference-card-description">
                                        Description courte du contenu, contexte scientifique,
                                        résumé ou métadonnée. Description courte du contenu, contexte scientifique,
                                        résumé ou métadonnée. Description courte du contenu, contexte scientifique,
                                        résumé ou métadonnée. Description courte du contenu, contexte scientifique,
                                        résumé ou métadonnée.
                                    </p>
                                </div>
                            </p:commandLink>
                        </div>
                    </h:form>
                    </div>
                </div>
            </div>
        </div>
    </h:panelGroup>

    <!-- Inclusion du dialog de création de référentiel -->
    <ui:include src="../dialogs/categoryDialog.xhtml"/>
</ui:composition>
