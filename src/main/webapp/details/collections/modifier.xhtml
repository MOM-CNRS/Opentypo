<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:fn="http://xmlns.jcp.org/jsf/functions">

    <h:panelGroup id="createCandidatForm" layout="block">
        <div class="wizard-content candidats-p-20">

            <ui:include src="../../candidats/form/labels-form.xhtml"/>

            <ui:include src="../../candidats/form/descriptions-form.xhtml"/>

            <!-- Référence bibliographique (liste de chaînes, stockée avec séparateur ";" dans rereference_bibliographique) -->
            <div class="users-form-group users-form-group-full candidats-mt-10">
                <p:outputLabel value="Référence bibliographique" style="margin-bottom: 13px !important" />
                <div class="periode-field-row candidat-production-wrapper candidat-production-group">
                    <div class="input-wrapper periode-input-wrapper candidats-input-wrapper-border candidats-mt--10">
                        <i class="pi pi-book input-icon input-icon-textarea" />
                        <p:chips id="referenceBibliographique"
                                 value="#{candidatBean.referencesBibliographiques}"
                                 styleClass="users-textarea"
                                 style="width: 100%"
                                 placeholder="Ajouter une référence (ex: Auteur, Titre, Éditeur, année)"
                                 separator=";"
                                 rendered="#{candidatBean.canEditCurrentBrouillon()}"/>
                        <div class="bibliographie-readonly candidats-mt-10" rendered="#{candidatBean.isCurrentBrouillonReadOnly()}">
                            <ui:repeat value="#{candidatBean.referencesBibliographiques}" var="ref">
                                <ui:fragment rendered="#{not empty ref and fn:trim(ref) != ''}">
                                    <span class="bibliographie-badge"><span class="bibliographie-badge-text">#{fn:trim(ref)}</span></span>
                                </ui:fragment>
                            </ui:repeat>
                            <h:outputText value="Aucune référence bibliographique"
                                          rendered="#{empty candidatBean.referencesBibliographiques}"
                                          styleClass="bibliographie-empty" />
                        </div>
                    </div>
                    <div class="periode-action-buttons">
                        <p:commandButton icon="pi pi-check"
                                         rendered="#{candidatBean.canEditCurrentBrouillon()}"
                                         styleClass="candidat-btn-save"
                                         actionListener="#{candidatBean.saveReferencesBibliographiques}"
                                         process="@form"
                                         ajax="true"
                                         update=":collectionEditForm :growl"
                                         title="Enregistrer les références bibliographiques"/>
                    </div>
                </div>
            </div>

            <div class="users-form-group users-form-group-full periode-group candidats-mt-10">
                <p:outputLabel value="Gestionnaires de la collection" style="margin-bottom: 13px !important" />
                <p:pickList value="#{collectionBean.editingGestionnairesPickList}"
                            var="userId"
                            itemLabel="#{collectionBean.getUtilisateurDisplayName(userId)}"
                            itemValue="#{userId}"
                            converter="pickListLongConverter"
                            styleClass="group-dialog-picklist"
                            showSourceFilter="true"
                            showTargetFilter="true"
                            filterMatchMode="contains"
                            sourceFilterPlaceholder="Rechercher..."
                            targetFilterPlaceholder="Rechercher..."
                            responsive="true"
                            rendered="#{not empty collectionBean.gestionnairesList}"/>
                <h:panelGroup rendered="#{empty collectionBean.gestionnairesList}" class="group-dialog-no-relecteurs">
                    <span>Aucun utilisateur disponible</span>
                </h:panelGroup>
                <div class="periode-action-buttons candidats-mt-10">
                    <p:commandButton value="Enregistrer les gestionnaires"
                                     icon="pi pi-check"
                                     styleClass="candidat-btn-save"
                                     actionListener="#{collectionBean.saveGestionnairesOnly(applicationBean)}"
                                     process="@form"
                                     ajax="true"
                                     update=":collectionEditForm :growl"
                                     title="Enregistrer les gestionnaires"/>
                </div>
            </div>
        </div>

        <div class="collection-edit-actions candidats-mt-20">
            <p:commandButton value="Retour"
                             action="#{collectionBean.cancelEditingCollection(applicationBean)}"
                             process="@this"
                             update=":collectionEditForm :growl"
                             styleClass="collection-edit-btn collection-edit-btn-cancel"
                             immediate="true"/>
        </div>
    </h:panelGroup>

    <h:outputStylesheet library="css" name="candidats/candidats-forms-common.css"/>
    <h:outputStylesheet library="css" name="candidats/candidats-group-form.css"/>
    <h:outputStylesheet library="css" name="candidats/candidats-category-form.css"/>

    <style>
        .wizard-content .users-form-group > label, .wizard-content .users-form-group .ui-outputlabel {
            font-size: 0.85rem !important;
        }
    </style>
</ui:composition>
